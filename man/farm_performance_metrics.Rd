% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/farm_performance_metrics.R
\name{farm_performance_metrics}
\alias{farm_performance_metrics}
\title{Farm performance metrics by scenario and disaggregate}
\usage{
farm_performance_metrics(
  year,
  agent_identifiers = c("commodity_year", "state_code", "county_code", "commodity_code",
    "type_code", "practice_code", "unit_structure_code", "insurance_plan_code",
    "coverage_level_percent"),
  outcome_list = c("its", "Iits", "rrs1", "rrs2", "rrs3", "Irrs1", "Irrs2", "Irrs3",
    "sner1", "sner2", "sner3", "Simrate", "SimrateP", "Simsuby", "Simlcr", "rrp1",
    "rrp2", "rrp3", "itp"),
  combo,
  weight_variable = NULL,
  expected_directory = NULL,
  draw = NULL,
  draw_list_file_path = NULL,
  disaggregates = NULL,
  output_file_path = NULL,
  distributional_limits = c(0.05, 0.95)
)
}
\arguments{
\item{year}{Policy year used to locate \verb{expected_<year>.rds}.}

\item{agent_identifiers}{Character vector of ID columns for grouping prior to long-pivot and averaging.}

\item{outcome_list}{Character vector of outcome columns to reshape and aggregate.}

\item{combo}{Target scenario (e.g., \code{"Basic+CURRENT"}, \code{"Basic+SCO8665"}, or another).}

\item{weight_variable}{\code{NULL} for equal weights (=1) or a character name of a numeric weight column.}

\item{expected_directory}{Directory containing \verb{expected_<year>.rds}.}

\item{draw}{Optional draw identifier used for filtering and filename tag.}

\item{draw_list_file_path}{Optional path to an RDS (named list) with the draw table; required if \code{draw} is not \code{NULL}.}

\item{disaggregates}{Optional character vector of additional disaggregate columns (alongside \code{"FCIP"}).}

\item{output_file_path}{Output file path}

\item{distributional_limits}{Numeric length-2 vector of lower/upper probabilities (e.g., \code{c(0.05, 0.95)}); must satisfy \verb{0 < p1 < p2 < 1}.}
}
\value{
Invisibly returns the character path of the saved \code{.rds}.
}
\description{
Load \verb{expected_<year>.rds}, derive outcome variables, compute deltas vs. baselines,
trim extremes using quantile limits, aggregate (weighted mean/median) by requested
disaggregates, and save a summarized \code{.rds}. Returns the saved path invisibly.
}
\details{
Steps:
\enumerate{
\item Filter rows to \verb{combination \%in\% \{"Basic+CURRENT", combo, "Basic+SCO8665"\}}.
\item Create derived metrics: \code{rrs1/2/3}, \code{its}, flags \verb{Irrs*}/\code{Iits}, \verb{sner*},
percent/level transforms (\verb{rrp*}, \code{itp}), and scale \verb{Sim*} by 100.
\item Reshape to long on \code{outcome_list}, drop non-finite values, average within
identifiers (\code{agent_identifiers}, and \code{weight_variable} if provided), scenario, variable.
\item Join baselines: if \code{combo != "Basic+CURRENT"}, add \code{"Basic+CURRENT"} as \code{base00};
if \verb{combo = \{"Basic+SCO8665","Basic+CURRENT"\}}, add \code{"Basic+SCO8665"} as \code{base01}.
Compute \code{chglvl00/01} and \code{chgpct00/01} (guard divide-by-zero).
\item Build labels \code{PLAN}, \code{RPYP}, \code{COV}, \code{STRUCT}.
\item Compute trimming limits per (\code{variable}, \code{combination}, \code{state_code}, \code{IRR}, \code{commodity_code})
using \code{distributional_limits} (default \code{c(0.05,0.95)}), require n greater or equal to 20, and cap to \verb{*T} columns.
\item For each of \code{c("FCIP", disaggregates)}, compute weighted mean and weighted median of
raw and trimmed metrics; stack results and write output.
}
}
\note{
Baseline joins use \code{nomatch = 0} by design, so rows missing in the baseline are dropped
before delta computation. Change to \code{nomatch = NA} if you prefer to retain such rows with \code{NA} deltas.
}
\section{Required columns}{

All \code{agent_identifiers}, plus:
\code{combination}, \code{state_code}, \code{county_code}, \code{commodity_code}, \code{type_code}, \code{practice_code},
\code{IRR}, \code{Relcv}, \code{Relnlrpv}, \code{Relnlapv}, \code{Relmean}, \code{Simrate}, \code{SimrateP}, \code{Simsuby}, \code{Simlcr},
\code{coverage_level_percent}, \code{unit_structure_code}, \code{insurance_plan_code}.
If \code{weight_variable} is not \code{NULL}, that column must exist and be numeric.
}

\seealso{
data.table::data.table, data.table::melt, matrixStats::weightedMedian
}
