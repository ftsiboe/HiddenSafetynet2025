% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/expected_outcomes.R
\name{aggregate_expected_outcomes}
\alias{aggregate_expected_outcomes}
\title{Aggregate and winsorize expected outcomes (year-level)}
\usage{
aggregate_expected_outcomes(
  year,
  expected_directory = NULL,
  output_directory = NULL,
  study_environment,
  agent_identifiers = c("commodity_year", "state_code", "county_code", "type_code"),
  disaggregate = NULL
)
}
\arguments{
\item{year}{Integer. Year to aggregate.}

\item{expected_directory}{Character or NULL. Directory containing per-task
\code{expected_*.rds} files for the year. If NULL, uses
\code{file.path(study_environment$wd$dir_expected, year)}.}

\item{output_directory}{Character or NULL. Directory to write the aggregated
file. If NULL, uses \code{study_environment$wd$dir_expected}.}

\item{study_environment}{List. Must provide \verb{$wd$dir_expected} (and is used to
resolve defaults when directories are NULL).}

\item{agent_identifiers}{Character vector. Grouping keys used for by-group
winsorization (default: \code{c("commodity_year","state_code","county_code","type_code")}).}

\item{disaggregate}{Character or NULL. Optional extra grouping column (e.g.,
\code{"combination"}). If provided but missing, it is created as \code{"ALL"}.}
}
\value{
Invisibly returns the path to the saved file.
}
\description{
Loads all per-task expected outcome files for a given year, aggregates them,
winsorizes key relative metrics within groups (5th-95th percentiles), and
saves a single cleaned file.
}
\details{
Reads all \code{.rds} files under \code{expected_directory}, binds them, computes 5th and
95th percentiles for \code{Relmean}, \code{Relsd}, \code{Relcv}, \code{Rellapv}, \code{Rellrpv},
\code{Relnlapv}, \code{Relnlrpv}, \code{Relvar} within each group, caps values to that range,
and writes \verb{expected_<year>.rds} to \code{output_directory}.
}
