% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/supplemental_protection_simulator.R
\name{build_agent_simulation_data}
\alias{build_agent_simulation_data}
\title{Build agent simulation panel}
\usage{
build_agent_simulation_data(
  year,
  sim,
  agents_directory = "data/cleaned_agents_data"
)
}
\arguments{
\item{year}{Integer. Crop year.}

\item{sim}{Integer vector. Draw number(s) to keep.}

\item{agents_directory}{Character. Directory containing cleaned agent data.
Default: \code{"data/cleaned_agents_data"}.}
}
\value{
A \link[data.table]{data.table} containing all original columns plus:
\itemize{
\item \code{expected_county_yield}
\item \code{final_county_yield}
\item \code{harvest_price}
\item \code{revenue}
}
}
\description{
Read cleaned agent-level simulation data for a crop year, unnest per-draw
outcomes, filter to the requested draw(s), compute county-level expected
yields, and add per-row revenue.
}
\details{
The function:
\enumerate{
\item Loads \code{cleaned_agents_data_<year>.rds} from \code{agents_directory}.
\item Unnests draw pools: number, farm yield/price, and county yield/price.
\item Filters to \code{sim} (matching \code{rma_draw_number}).
\item Renames simulated fields to canonical names and floors negative
county yields at zero.
\item Computes a planted-acre-weighted \code{expected_county_yield}.
\item Computes row-level \code{revenue = actual_farm_yield * actual_price * planted_acres}.
}
}
